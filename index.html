<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>Mario Style Web Game</title>
<style>
body{
    margin:0;
    overflow:hidden;
    background:#87CEEB;
    font-family:Arial, sans-serif;
}
canvas{
    display:block;
}
#ui{
    position:fixed;
    top:10px;
    left:10px;
    font-weight:bold;
    color:#000;
}
</style>
</head>
<body>

<div id="ui">Счёт: <span id="score">0</span></div>
<canvas id="game"></canvas>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");
canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

const gravity = 0.6;
let cameraX = 0;
let score = 0;

const player = {
    x:100,
    y:0,
    w:40,
    h:50,
    vx:0,
    vy:0,
    speed:5,
    jump:-12,
    onGround:false
};

const keys = {};
document.addEventListener("keydown",e=>keys[e.code]=true);
document.addEventListener("keyup",e=>keys[e.code]=false);

const platforms = [
    {x:0,y:500,w:3000,h:40},
    {x:300,y:420,w:200,h:20},
    {x:650,y:350,w:200,h:20},
    {x:1000,y:300,w:200,h:20},
    {x:1400,y:400,w:200,h:20},
    {x:1800,y:320,w:200,h:20}
];

const coins = [
    {x:350,y:380,collected:false},
    {x:700,y:310,collected:false},
    {x:1050,y:260,collected:false},
    {x:1450,y:360,collected:false},
    {x:1850,y:280,collected:false}
];

const enemies = [
    {x:600,y:460,w:40,h:40,dir:1},
    {x:1200,y:460,w:40,h:40,dir:1},
    {x:1700,y:460,w:40,h:40,dir:1}
];

function update(){

    // движение
    player.vx = 0;
    if(keys["ArrowLeft"]) player.vx = -player.speed;
    if(keys["ArrowRight"]) player.vx = player.speed;

    if(keys["Space"] && player.onGround){
        player.vy = player.jump;
        player.onGround = false;
    }

    player.vy += gravity;

    player.x += player.vx;
    player.y += player.vy;

    player.onGround = false;

    // платформы
    for(let p of platforms){
        if(
            player.x < p.x + p.w &&
            player.x + player.w > p.x &&
            player.y < p.y + p.h &&
            player.y + player.h > p.y
        ){
            if(player.vy > 0){
                player.y = p.y - player.h;
                player.vy = 0;
                player.onGround = true;
            }
        }
    }

    // монеты
    for(let coin of coins){
        if(!coin.collected &&
            player.x < coin.x + 20 &&
            player.x + player.w > coin.x &&
            player.y < coin.y + 20 &&
            player.y + player.h > coin.y
        ){
            coin.collected = true;
            score += 10;
            document.getElementById("score").textContent = score;
        }
    }

    // враги
    for(let e of enemies){
        e.x += 2 * e.dir;
        if(e.x < 0 || e.x > 2800) e.dir *= -1;

        if(
            player.x < e.x + e.w &&
            player.x + player.w > e.x &&
            player.y < e.y + e.h &&
            player.y + player.h > e.y
        ){
            // прыжок на врага
            if(player.vy > 0){
                e.x = -1000;
                player.vy = -8;
                score += 20;
                document.getElementById("score").textContent = score;
            } else {
                // проигрыш
                alert("Ты проиграл!");
                location.reload();
            }
        }
    }

    // камера
    cameraX = player.x - canvas.width/3;

}

function draw(){

    ctx.clearRect(0,0,canvas.width,canvas.height);

    ctx.save();
    ctx.translate(-cameraX,0);

    // платформы
    ctx.fillStyle="#654321";
    for(let p of platforms){
        ctx.fillRect(p.x,p.y,p.w,p.h);
    }

    // монеты
    ctx.fillStyle="gold";
    for(let coin of coins){
        if(!coin.collected){
            ctx.beginPath();
            ctx.arc(coin.x+10,coin.y+10,10,0,Math.PI*2);
            ctx.fill();
        }
    }

    // враги
    ctx.fillStyle="green";
    for(let e of enemies){
        ctx.fillRect(e.x,e.y,e.w,e.h);
    }

    // игрок
    ctx.fillStyle="red";
    ctx.fillRect(player.x,player.y,player.w,player.h);

    ctx.restore();

    // финиш
    ctx.fillStyle="black";
    ctx.fillRect(2900 - cameraX,450,20,50);
}

function gameLoop(){
    update();
    draw();
    requestAnimationFrame(gameLoop);
}

gameLoop();
</script>

</body>
</html>
