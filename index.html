<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Mario Style Game</title>

<style>
body {
  margin: 0;
  overflow: hidden;
  background: #87CEEB;
  font-family: Arial;
}

canvas {
  display: block;
}

.controls {
  position: fixed;
  bottom: 20px;
  width: 100%;
  display: flex;
  justify-content: space-between;
  padding: 0 30px;
}

button {
  width: 70px;
  height: 70px;
  font-size: 28px;
  border-radius: 50%;
  border: none;
  background: rgba(0,0,0,0.4);
  color: white;
}
</style>
</head>

<body>

<canvas id="game"></canvas>

<div class="controls">
  <button id="left">◀</button>
  <button id="jump">▲</button>
  <button id="right">▶</button>
</div>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

let gravity = 0.6;

const player = {
  x: 100,
  y: 100,
  width: 40,
  height: 40,
  vx: 0,
  vy: 0,
  speed: 4,
  jump: -12,
  onGround: false
};

let cameraX = 0;
let score = 0;

const platforms = [
  {x:0, y:400, w:2000, h:40},
  {x:300, y:320, w:150, h:20},
  {x:550, y:260, w:150, h:20},
  {x:800, y:200, w:150, h:20}
];

const coins = [
  {x:350, y:280, r:10, taken:false},
  {x:600, y:220, r:10, taken:false},
  {x:850, y:160, r:10, taken:false}
];

const keys = {
  left:false,
  right:false
};

function update() {
  player.vx = 0;

  if (keys.left) player.vx = -player.speed;
  if (keys.right) player.vx = player.speed;

  player.vy += gravity;
  player.x += player.vx;
  player.y += player.vy;

  player.onGround = false;

  platforms.forEach(p => {
    if (
      player.x < p.x + p.w &&
      player.x + player.width > p.x &&
      player.y < p.y + p.h &&
      player.y + player.height > p.y
    ) {
      if (player.vy > 0) {
        player.y = p.y - player.height;
        player.vy = 0;
        player.onGround = true;
      }
    }
  });

  coins.forEach(c => {
    if (!c.taken) {
      let dx = player.x + player.width/2 - c.x;
      let dy = player.y + player.height/2 - c.y;
      let dist = Math.sqrt(dx*dx + dy*dy);
      if (dist < 30) {
        c.taken = true;
        score++;
      }
    }
  });

  cameraX = player.x - canvas.width / 2;
}

function draw() {
  ctx.clearRect(0,0,canvas.width,canvas.height);

  ctx.save();
  ctx.translate(-cameraX,0);

  // платформы
  ctx.fillStyle = "#5c3a1e";
  platforms.forEach(p=>{
    ctx.fillRect(p.x,p.y,p.w,p.h);
  });

  // монеты
  coins.forEach(c=>{
    if(!c.taken){
      ctx.beginPath();
      ctx.arc(c.x,c.y,c.r,0,Math.PI*2);
      ctx.fillStyle="gold";
      ctx.fill();
    }
  });

  // игрок
  ctx.fillStyle = "red";
  ctx.fillRect(player.x,player.y,player.width,player.height);

  ctx.restore();

  // счет
  ctx.fillStyle = "black";
  ctx.font = "20px Arial";
  ctx.fillText("Счет: " + score, 20, 30);
}

function gameLoop(){
  update();
  draw();
  requestAnimationFrame(gameLoop);
}

gameLoop();

// кнопки телефона
const leftBtn = document.getElementById("left");
const rightBtn = document.getElementById("right");
const jumpBtn = document.getElementById("jump");

leftBtn.addEventListener("touchstart", ()=> keys.left = true);
leftBtn.addEventListener("touchend", ()=> keys.left = false);

rightBtn.addEventListener("touchstart", ()=> keys.right = true);
rightBtn.addEventListener("touchend", ()=> keys.right = false);

jumpBtn.addEventListener("touchstart", ()=>{
  if(player.onGround){
    player.vy = player.jump;
  }
});

// клавиатура (для ПК)
document.addEventListener("keydown", e=>{
  if(e.key==="ArrowLeft") keys.left = true;
  if(e.key==="ArrowRight") keys.right = true;
  if(e.key===" " && player.onGround) player.vy = player.jump;
});

document.addEventListener("keyup", e=>{
  if(e.key==="ArrowLeft") keys.left = false;
  if(e.key==="ArrowRight") keys.right = false;
});
</script>

</body>
</html>
